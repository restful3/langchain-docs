"""
================================================================================
LangChain AI Agent ë§ˆìŠ¤í„° êµì•ˆ
Part 3: ì²« ë²ˆì§¸ Agent ë§Œë“¤ê¸°
================================================================================

íŒŒì¼ëª…: 03_react_pattern.py
ë‚œì´ë„: â­â­â­â˜†â˜† (ì¤‘ê¸‰)
ì˜ˆìƒ ì‹œê°„: 25ë¶„

ğŸ“š í•™ìŠµ ëª©í‘œ:
  - ReAct íŒ¨í„´(Reasoning + Acting)ì˜ ê°œë… ì´í•´
  - ë‹¨ì¼ ë° ìˆœì°¨ ë„êµ¬ í˜¸ì¶œ íŒ¨í„´ í•™ìŠµ
  - ë³‘ë ¬ ë„êµ¬ í˜¸ì¶œì˜ í™œìš©
  - ì™„ì „í•œ ReAct ë£¨í”„ ì‹¤ìŠµ

ğŸ“– ê³µì‹ ë¬¸ì„œ:
  â€¢ Agents: /official/06-agents.md (ë¼ì¸ 178-237)
  â€¢ ReAct íŒ¨í„´: https://arxiv.org/abs/2210.03629

ğŸ“„ êµì•ˆ ë¬¸ì„œ:
  â€¢ Part 3 ê°œìš”: /docs/part03_first_agent.md (ì„¹ì…˜ 3)

ğŸ”§ í•„ìš”í•œ íŒ¨í‚¤ì§€:
  pip install langchain langchain-openai python-dotenv

ğŸ”‘ í•„ìš”í•œ í™˜ê²½ë³€ìˆ˜:
  - OPENAI_API_KEY

ğŸš€ ì‹¤í–‰ ë°©ë²•:
  python 03_react_pattern.py

================================================================================
"""

# ============================================================================
# Imports
# ============================================================================

import os
from dotenv import load_dotenv
from langchain.agents import create_agent
from langchain_openai import ChatOpenAI
from langchain.tools import tool
import time

# ============================================================================
# í™˜ê²½ ì„¤ì •
# ============================================================================

# .env íŒŒì¼ì—ì„œ í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
load_dotenv()

# API í‚¤ í™•ì¸
if not os.getenv("OPENAI_API_KEY"):
    print("âŒ ì˜¤ë¥˜: OPENAI_API_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
    print("ğŸ“ .env íŒŒì¼ì„ í™•ì¸í•˜ê³  API í‚¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”.")
    exit(1)

# ============================================================================
# ì˜ˆì œ 1: ReActë€? (ê°œë… ì„¤ëª…)
# ============================================================================

def example_1_what_is_react():
    """ReAct íŒ¨í„´ì˜ ê°œë…ê³¼ êµ¬ì¡°"""
    print("=" * 70)
    print("ğŸ“Œ ì˜ˆì œ 1: ReAct íŒ¨í„´ì´ë€?")
    print("=" * 70)

    print("""
ğŸ”¹ ReAct (Reasoning + Acting):
   AI Agentê°€ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” í•µì‹¬ íŒ¨í„´ì…ë‹ˆë‹¤.
   ì¶”ë¡ (Reasoning)ê³¼ í–‰ë™(Acting)ì„ ë²ˆê°ˆì•„ê°€ë©° ëª©í‘œë¥¼ ë‹¬ì„±í•©ë‹ˆë‹¤.

ğŸ”„ ReAct ë£¨í”„:

   1ï¸âƒ£ Reasoning (ì¶”ë¡ )
      â†’ "ë¬´ì—‡ì„ ì•Œì•„ì•¼ í•˜ëŠ”ê°€?"
      â†’ "ì–´ë–¤ ë„êµ¬ë¥¼ ì‚¬ìš©í•  ê²ƒì¸ê°€?"

   2ï¸âƒ£ Acting (í–‰ë™)
      â†’ ë„êµ¬ ì‹¤í–‰
      â†’ ì™¸ë¶€ ì‹œìŠ¤í…œ í˜¸ì¶œ

   3ï¸âƒ£ Observation (ê´€ì°°)
      â†’ ë„êµ¬ ì‹¤í–‰ ê²°ê³¼ í™•ì¸
      â†’ ìƒˆë¡œìš´ ì •ë³´ íšë“

   4ï¸âƒ£ ë°˜ë³µ ë˜ëŠ” ì¢…ë£Œ
      â†’ ì •ë³´ê°€ ì¶©ë¶„í•˜ë©´: ìµœì¢… ë‹µë³€
      â†’ ì •ë³´ê°€ ë¶€ì¡±í•˜ë©´: 1ë²ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°

ğŸ“Š ì‹¤ì œ ì˜ˆì‹œ:

   [ì‚¬ìš©ì] "ì„œìš¸ê³¼ ë¶€ì‚° ì¤‘ ì–´ë””ê°€ ë” ë”°ëœ»í•´?"

   [Reasoning 1] "ë‘ ë„ì‹œì˜ ì˜¨ë„ë¥¼ ë¹„êµí•´ì•¼ í•˜ë¯€ë¡œ ë‚ ì”¨ ì •ë³´ê°€ í•„ìš”í•˜ë‹¤"
   [Acting 1]    get_weather("ì„œìš¸"), get_weather("ë¶€ì‚°") í˜¸ì¶œ
   [Observation] ì„œìš¸: 22Â°C, ë¶€ì‚°: 20Â°C

   [Reasoning 2] "ì´ì œ ë¹„êµí•  ìˆ˜ ìˆë‹¤. ì„œìš¸ì´ 2ë„ ë” ë†’ë‹¤"
   [Final]       "ì„œìš¸ì´ ë¶€ì‚°ë³´ë‹¤ 2ë„ ë” ë”°ëœ»í•©ë‹ˆë‹¤"

ğŸ’¡ ReActì˜ ì¥ì :
   - í•´ì„ ê°€ëŠ¥ì„±: ê° ë‹¨ê³„ì˜ ì¶”ë¡  ê³¼ì •ì„ í™•ì¸ ê°€ëŠ¥
   - ìœ ì—°ì„±: ì˜ˆìƒì¹˜ ëª»í•œ ìƒí™©ì— ëŒ€ì‘ ê°€ëŠ¥
   - íš¨ìœ¨ì„±: í•„ìš”í•œ ë§Œí¼ë§Œ ë„êµ¬ë¥¼ ì‚¬ìš©
   - ë””ë²„ê¹… ìš©ì´: ì–´ëŠ ë‹¨ê³„ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆëŠ”ì§€ íŒŒì•… ê°€ëŠ¥
    """)

    print("\nğŸ’¡ í•µì‹¬ í¬ì¸íŠ¸:")
    print("  - ReActëŠ” LLMì´ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤")
    print("  - ì¶”ë¡  â†’ í–‰ë™ â†’ ê´€ì°°ì„ ë°˜ë³µí•˜ì—¬ ëª©í‘œ ë‹¬ì„±")
    print("  - LangChainì˜ create_agent()ëŠ” ìë™ìœ¼ë¡œ ReAct ë£¨í”„ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤\n")


# ============================================================================
# ì˜ˆì œ 2: ë‹¨ì¼ ë„êµ¬ í˜¸ì¶œ (Reasoning â†’ Action â†’ Observation)
# ============================================================================

def example_2_single_tool_call():
    """ê°€ì¥ ê°„ë‹¨í•œ ReAct: í•œ ë²ˆì˜ ë„êµ¬ í˜¸ì¶œ"""
    print("=" * 70)
    print("ğŸ“Œ ì˜ˆì œ 2: ë‹¨ì¼ ë„êµ¬ í˜¸ì¶œ - ê¸°ë³¸ ReAct")
    print("=" * 70)

    # ë„êµ¬ ì •ì˜
    @tool
    def get_weather(city: str) -> str:
        """ì£¼ì–´ì§„ ë„ì‹œì˜ í˜„ì¬ ë‚ ì”¨ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

        Args:
            city: ë„ì‹œ ì´ë¦„ (ì˜ˆ: ì„œìš¸, ë¶€ì‚°)
        """
        print(f"      [ë„êµ¬ ì‹¤í–‰] get_weather('{city}') í˜¸ì¶œ")
        time.sleep(0.5)  # API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜

        weather_data = {
            "ì„œìš¸": "ë§‘ìŒ, 22Â°C",
            "ë¶€ì‚°": "íë¦¼, 20Â°C",
        }
        result = weather_data.get(city, f"{city}ì˜ ë‚ ì”¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
        print(f"      [ë„êµ¬ ê²°ê³¼] {result}")
        return result

    # Agent ìƒì„±
    model = ChatOpenAI(model="gpt-4o-mini", temperature=0)
    agent = create_agent(
        model=model,
        tools=[get_weather],
        system_prompt="ë‹¹ì‹ ì€ ë‚ ì”¨ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” Agentì…ë‹ˆë‹¤. í•­ìƒ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.",
    )

    # ReAct ì‹¤í–‰
    print("\nğŸ‘¤ ì‚¬ìš©ì: ì„œìš¸ ë‚ ì”¨ëŠ”?")
    print("\nğŸ”„ ReAct ë£¨í”„ ì‹œì‘:\n")

    print("   1ï¸âƒ£ [Reasoning] Agentê°€ ìƒê° ì¤‘...")
    print("      'ì„œìš¸ì˜ ë‚ ì”¨ ì •ë³´ê°€ í•„ìš”í•˜ë¯€ë¡œ get_weather ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì•¼ê² ë‹¤'")

    print("\n   2ï¸âƒ£ [Acting] ë„êµ¬ í˜¸ì¶œ ì¤‘...")
    result = agent.invoke({
        "messages": [{"role": "user", "content": "ì„œìš¸ ë‚ ì”¨ëŠ”?"}]
    })

    print("\n   3ï¸âƒ£ [Observation] ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìµœì¢… ë‹µë³€ ìƒì„±")
    print(f"\nğŸ¤– Agent: {result['messages'][-1].content}")

    print("\nğŸ’¡ í•µì‹¬ í¬ì¸íŠ¸:")
    print("  - ë‹¨ìˆœí•œ ì§ˆë¬¸ë„ Reasoning â†’ Acting â†’ Observation ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤")
    print("  - Agentê°€ ìë™ìœ¼ë¡œ ë„êµ¬ ì‚¬ìš© ì—¬ë¶€ë¥¼ ê²°ì •í–ˆìŠµë‹ˆë‹¤")
    print("  - ë„êµ¬ ê²°ê³¼ë¥¼ ìì—°ì–´ë¡œ ë³€í™˜í•˜ì—¬ ë‹µë³€í–ˆìŠµë‹ˆë‹¤\n")


# ============================================================================
# ì˜ˆì œ 3: ìˆœì°¨ì  ë„êµ¬ í˜¸ì¶œ (Multiple Sequential Tool Calls)
# ============================================================================

def example_3_sequential_tool_calls():
    """ì—¬ëŸ¬ ë„êµ¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œí•˜ëŠ” ReAct"""
    print("=" * 70)
    print("ğŸ“Œ ì˜ˆì œ 3: ìˆœì°¨ì  ë„êµ¬ í˜¸ì¶œ - ë³µì¡í•œ ReAct")
    print("=" * 70)

    # ë„êµ¬ ì •ì˜
    @tool
    def search_product(query: str) -> str:
        """ì œí’ˆì„ ê²€ìƒ‰í•©ë‹ˆë‹¤.

        Args:
            query: ê²€ìƒ‰í•  ì œí’ˆ í‚¤ì›Œë“œ
        """
        print(f"      [ë„êµ¬ ì‹¤í–‰] search_product('{query}')")
        time.sleep(0.5)

        products = {
            "wireless headphones": "ìƒìœ„ 5ê°œ ì œí’ˆ: WH-1000XM5, AirPods Max, Bose QC45, Sennheiser Momentum, Bang & Olufsen H95",
            "laptop": "ìƒìœ„ 5ê°œ ì œí’ˆ: MacBook Pro, Dell XPS, ThinkPad X1, Surface Laptop, HP Spectre",
        }
        result = products.get(query, f"'{query}'ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤")
        print(f"      [ë„êµ¬ ê²°ê³¼] {result}")
        return result

    @tool
    def check_inventory(product_id: str) -> str:
        """ì œí’ˆ ì¬ê³ ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

        Args:
            product_id: ì œí’ˆ ID ë˜ëŠ” ì´ë¦„
        """
        print(f"      [ë„êµ¬ ì‹¤í–‰] check_inventory('{product_id}')")
        time.sleep(0.5)

        inventory = {
            "WH-1000XM5": "ì¬ê³  10ê°œ ìˆìŒ",
            "AirPods Max": "í’ˆì ˆ",
            "MacBook Pro": "ì¬ê³  5ê°œ ìˆìŒ",
        }
        result = inventory.get(product_id, f"'{product_id}' ì¬ê³  ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤")
        print(f"      [ë„êµ¬ ê²°ê³¼] {result}")
        return result

    # Agent ìƒì„±
    model = ChatOpenAI(model="gpt-4o-mini", temperature=0)
    agent = create_agent(
        model=model,
        tools=[search_product, check_inventory],
        system_prompt="ë‹¹ì‹ ì€ ì œí’ˆ ê²€ìƒ‰ê³¼ ì¬ê³  í™•ì¸ì„ ë„ì™€ì£¼ëŠ” ì‡¼í•‘ Agentì…ë‹ˆë‹¤.",
    )

    # ReAct ì‹¤í–‰
    print("\nğŸ‘¤ ì‚¬ìš©ì: ì§€ê¸ˆ ê°€ì¥ ì¸ê¸°ìˆëŠ” ë¬´ì„  í—¤ë“œí°ì„ ì°¾ì•„ì„œ ì¬ê³ ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì¤˜")
    print("\nğŸ”„ ReAct ë£¨í”„ ì‹œì‘:\n")

    print("   1ï¸âƒ£ [Reasoning 1] 'ì¸ê¸° ì œí’ˆì„ ì°¾ê¸° ìœ„í•´ search_productë¥¼ ë¨¼ì € ì‚¬ìš©í•´ì•¼ê² ë‹¤'")
    print("\n   2ï¸âƒ£ [Acting 1] ì œí’ˆ ê²€ìƒ‰...")

    result = agent.invoke({
        "messages": [{"role": "user", "content": "ì§€ê¸ˆ ê°€ì¥ ì¸ê¸°ìˆëŠ” ë¬´ì„  í—¤ë“œí°ì„ ì°¾ì•„ì„œ ì¬ê³ ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì¤˜"}]
    })

    print("\n   3ï¸âƒ£ [Observation 1] ê²€ìƒ‰ ê²°ê³¼ í™•ì¸: WH-1000XM5ê°€ 1ìˆœìœ„")
    print("\n   4ï¸âƒ£ [Reasoning 2] 'ì´ì œ WH-1000XM5ì˜ ì¬ê³ ë¥¼ í™•ì¸í•´ì•¼ê² ë‹¤'")
    print("\n   5ï¸âƒ£ [Acting 2] ì¬ê³  í™•ì¸...")
    print("\n   6ï¸âƒ£ [Observation 2] ì¬ê³  10ê°œ ìˆìŒ")
    print("\n   7ï¸âƒ£ [Final Answer] ëª¨ë“  ì •ë³´ê°€ ëª¨ì˜€ìœ¼ë¯€ë¡œ ìµœì¢… ë‹µë³€ ìƒì„±")

    print(f"\nğŸ¤– Agent: {result['messages'][-1].content}")

    print("\nğŸ’¡ í•µì‹¬ í¬ì¸íŠ¸:")
    print("  - Agentê°€ ìë™ìœ¼ë¡œ 2ê°œì˜ ë„êµ¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œí–ˆìŠµë‹ˆë‹¤")
    print("  - ì²« ë²ˆì§¸ ë„êµ¬ì˜ ê²°ê³¼ê°€ ë‘ ë²ˆì§¸ ë„êµ¬ì˜ ì…ë ¥ì´ ë˜ì—ˆìŠµë‹ˆë‹¤")
    print("  - ì´ê²ƒì´ ReAct íŒ¨í„´ì˜ í˜ì…ë‹ˆë‹¤: ì²´ì¸ì²˜ëŸ¼ ì—°ê²°ëœ ì¶”ë¡ ê³¼ í–‰ë™\n")


# ============================================================================
# ì˜ˆì œ 4: ë³‘ë ¬ ë„êµ¬ í˜¸ì¶œ (Parallel Tool Calls)
# ============================================================================

def example_4_parallel_tool_calls():
    """ë…ë¦½ì ì¸ ë„êµ¬ë“¤ì„ ë³‘ë ¬ë¡œ í˜¸ì¶œí•˜ëŠ” ReAct"""
    print("=" * 70)
    print("ğŸ“Œ ì˜ˆì œ 4: ë³‘ë ¬ ë„êµ¬ í˜¸ì¶œ - íš¨ìœ¨ì ì¸ ReAct")
    print("=" * 70)

    # ë„êµ¬ ì •ì˜
    @tool
    def get_weather(city: str) -> str:
        """ë„ì‹œì˜ ë‚ ì”¨ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤."""
        print(f"      [ë„êµ¬ ì‹¤í–‰] get_weather('{city}')")
        time.sleep(0.5)

        weather_data = {
            "ì„œìš¸": "ë§‘ìŒ, 22Â°C",
            "ë¶€ì‚°": "íë¦¼, 20Â°C",
            "ì œì£¼": "ë¹„, 18Â°C",
        }
        result = weather_data.get(city, f"{city}ì˜ ë‚ ì”¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
        print(f"      [ë„êµ¬ ê²°ê³¼] {result}")
        return result

    # Agent ìƒì„±
    model = ChatOpenAI(model="gpt-4o-mini", temperature=0)
    agent = create_agent(
        model=model,
        tools=[get_weather],
        system_prompt="ë‹¹ì‹ ì€ ë‚ ì”¨ ë¹„êµë¥¼ ë„ì™€ì£¼ëŠ” Agentì…ë‹ˆë‹¤. ì—¬ëŸ¬ ë„ì‹œë¥¼ ë¹„êµí•  ë•ŒëŠ” íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì„¸ìš”.",
    )

    # ReAct ì‹¤í–‰
    print("\nğŸ‘¤ ì‚¬ìš©ì: ì„œìš¸, ë¶€ì‚°, ì œì£¼ ì¤‘ ì–´ë””ê°€ ê°€ì¥ ë”°ëœ»í•´?")
    print("\nğŸ”„ ReAct ë£¨í”„ ì‹œì‘:\n")

    print("   1ï¸âƒ£ [Reasoning] 'ì„¸ ë„ì‹œì˜ ì˜¨ë„ê°€ ëª¨ë‘ í•„ìš”í•˜ë‹¤. ë…ë¦½ì ì´ë¯€ë¡œ ë³‘ë ¬ë¡œ ì¡°íšŒí•˜ì'")
    print("\n   2ï¸âƒ£ [Acting] ë³‘ë ¬ ë„êµ¬ í˜¸ì¶œ...")
    print("      â†’ get_weather('ì„œìš¸')")
    print("      â†’ get_weather('ë¶€ì‚°')")
    print("      â†’ get_weather('ì œì£¼')")

    result = agent.invoke({
        "messages": [{"role": "user", "content": "ì„œìš¸, ë¶€ì‚°, ì œì£¼ ì¤‘ ì–´ë””ê°€ ê°€ì¥ ë”°ëœ»í•´?"}]
    })

    print("\n   3ï¸âƒ£ [Observation] ëª¨ë“  ê²°ê³¼ë¥¼ ë™ì‹œì— ë°›ìŒ")
    print("      ì„œìš¸: 22Â°C, ë¶€ì‚°: 20Â°C, ì œì£¼: 18Â°C")
    print("\n   4ï¸âƒ£ [Final Answer] ì˜¨ë„ ë¹„êµ í›„ ìµœì¢… ë‹µë³€")

    print(f"\nğŸ¤– Agent: {result['messages'][-1].content}")

    print("\nğŸ’¡ í•µì‹¬ í¬ì¸íŠ¸:")
    print("  - ë…ë¦½ì ì¸ ë„êµ¬ í˜¸ì¶œì€ ë³‘ë ¬ë¡œ ì‹¤í–‰ë˜ì–´ íš¨ìœ¨ì ì…ë‹ˆë‹¤")
    print("  - Agentê°€ ìë™ìœ¼ë¡œ ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ íŒë‹¨í–ˆìŠµë‹ˆë‹¤")
    print("  - ìˆœì°¨ vs ë³‘ë ¬ ê²°ì •ì€ LLMì˜ ì¶”ë¡  ëŠ¥ë ¥ì— ë‹¬ë ¤ìˆìŠµë‹ˆë‹¤\n")


# ============================================================================
# ì˜ˆì œ 5: ì™„ì „í•œ ReAct ë£¨í”„ with Final Answer
# ============================================================================

def example_5_complete_react_loop():
    """ì‹¤ì „ ìˆ˜ì¤€ì˜ ì™„ì „í•œ ReAct ë£¨í”„"""
    print("=" * 70)
    print("ğŸ“Œ ì˜ˆì œ 5: ì™„ì „í•œ ReAct ë£¨í”„ - ì‹¤ì „ ì˜ˆì œ")
    print("=" * 70)

    # ë„êµ¬ ì •ì˜
    @tool
    def search_news(topic: str) -> str:
        """ë‰´ìŠ¤ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤."""
        print(f"      [ë„êµ¬ ì‹¤í–‰] search_news('{topic}')")
        time.sleep(0.5)

        news_db = {
            "AI": "ìµœì‹  AI ë‰´ìŠ¤: OpenAIê°€ GPT-5 ì¶œì‹œ ì˜ˆì •, Google Gemini ì—…ë°ì´íŠ¸, AI ê·œì œ ë²•ì•ˆ í†µê³¼",
            "ë‚ ì”¨": "ê¸°ìƒ ë‰´ìŠ¤: í­ì—¼ ê²½ë³´ ë°œë ¹, íƒœí’ ë¶ìƒ ì¤‘, ì¥ë§ˆ ì‹œì‘",
        }
        result = news_db.get(topic, f"'{topic}'ì— ëŒ€í•œ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤")
        print(f"      [ë„êµ¬ ê²°ê³¼] {result}")
        return result

    @tool
    def summarize_text(text: str, max_length: int = 50) -> str:
        """í…ìŠ¤íŠ¸ë¥¼ ìš”ì•½í•©ë‹ˆë‹¤."""
        print(f"      [ë„êµ¬ ì‹¤í–‰] summarize_text(max_length={max_length})")
        time.sleep(0.5)

        # ê°„ë‹¨í•œ ìš”ì•½ (ì‹¤ì œë¡œëŠ” LLM í˜¸ì¶œ)
        summary = text[:max_length] + "..." if len(text) > max_length else text
        print(f"      [ë„êµ¬ ê²°ê³¼] {summary}")
        return summary

    @tool
    def check_fact(statement: str) -> str:
        """ì‚¬ì‹¤ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤."""
        print(f"      [ë„êµ¬ ì‹¤í–‰] check_fact('{statement}')")
        time.sleep(0.5)

        # ë”ë¯¸ íŒ©íŠ¸ì²´í¬
        if "GPT-5" in statement:
            result = "í™•ì¸ë¨: GPT-5 ì¶œì‹œ ê³„íšì€ ê³µì‹ ë°œí‘œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"
        else:
            result = "í™•ì¸ í•„ìš”: ì¶”ê°€ ê²€ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤"
        print(f"      [ë„êµ¬ ê²°ê³¼] {result}")
        return result

    # Agent ìƒì„±
    model = ChatOpenAI(model="gpt-4o-mini", temperature=0)
    agent = create_agent(
        model=model,
        tools=[search_news, summarize_text, check_fact],
        system_prompt="""ë‹¹ì‹ ì€ ë‰´ìŠ¤ ë¶„ì„ Agentì…ë‹ˆë‹¤.

ì‚¬ìš©ìê°€ ë‰´ìŠ¤ë¥¼ ìš”ì²­í•˜ë©´:
1. search_newsë¡œ ë‰´ìŠ¤ ê²€ìƒ‰
2. summarize_textë¡œ ìš”ì•½
3. ì¤‘ìš”í•œ ì‚¬ì‹¤ì€ check_factë¡œ ê²€ì¦
4. ìµœì¢… ë¶„ì„ ì œê³µ
        """,
    )

    # ReAct ì‹¤í–‰
    print("\nğŸ‘¤ ì‚¬ìš©ì: AI ê´€ë ¨ ìµœì‹  ë‰´ìŠ¤ë¥¼ ì°¾ì•„ì„œ ìš”ì•½í•˜ê³ , ì£¼ìš” ë‚´ìš©ì´ ì‚¬ì‹¤ì¸ì§€ í™•ì¸í•´ì¤˜")
    print("\nğŸ”„ ReAct ë£¨í”„ ì‹œì‘:\n")

    result = agent.invoke({
        "messages": [{"role": "user", "content": "AI ê´€ë ¨ ìµœì‹  ë‰´ìŠ¤ë¥¼ ì°¾ì•„ì„œ ìš”ì•½í•˜ê³ , ì£¼ìš” ë‚´ìš©ì´ ì‚¬ì‹¤ì¸ì§€ í™•ì¸í•´ì¤˜"}]
    })

    # ì‹¤í–‰ ê³¼ì • ì‹œê°í™”
    print("\nğŸ“Š ì‹¤í–‰ ê³¼ì • ì‹œê°í™”:\n")
    step = 1
    for msg in result["messages"]:
        role = msg.__class__.__name__

        if role == "HumanMessage":
            print(f"[Step {step}] ğŸ‘¤ ì‚¬ìš©ì ì…ë ¥")
            step += 1

        elif role == "AIMessage":
            if hasattr(msg, "tool_calls") and msg.tool_calls:
                print(f"[Step {step}] ğŸ¤” Reasoning + Acting")
                for tc in msg.tool_calls:
                    print(f"         â†’ {tc['name']}()")
                step += 1
            else:
                print(f"[Step {step}] ğŸ’¡ Final Answer")
                step += 1

        elif role == "ToolMessage":
            print(f"[Step {step}] ğŸ‘€ Observation")
            step += 1

    print(f"\nğŸ¤– ìµœì¢… ë‹µë³€:\n{result['messages'][-1].content}")

    print("\nğŸ’¡ í•µì‹¬ í¬ì¸íŠ¸:")
    print("  - ë³µì¡í•œ ì‘ì—…ë„ ReAct ë£¨í”„ë¡œ ìë™ ë¶„í•´ë©ë‹ˆë‹¤")
    print("  - Agentê°€ 3ê°œì˜ ë„êµ¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤")
    print("  - ê° ë‹¨ê³„ì˜ ê²°ê³¼ê°€ ë‹¤ìŒ ë‹¨ê³„ì˜ ì…ë ¥ì´ ë©ë‹ˆë‹¤")
    print("  - ì´ê²ƒì´ ì§„ì •í•œ 'Agent'ì˜ í˜ì…ë‹ˆë‹¤: ììœ¨ì  ë¬¸ì œ í•´ê²°\n")


# ============================================================================
# ë©”ì¸ ì‹¤í–‰
# ============================================================================

def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    print("\n")
    print("ğŸ“ LangChain AI Agent ë§ˆìŠ¤í„° êµì•ˆ")
    print("ğŸ“– Part 3: ì²« ë²ˆì§¸ Agent ë§Œë“¤ê¸° - ReAct íŒ¨í„´")
    print("\n")

    # ëª¨ë“  ì˜ˆì œ ì‹¤í–‰
    example_1_what_is_react()
    input("\nâ ê³„ì†í•˜ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”...")

    example_2_single_tool_call()
    input("\nâ ê³„ì†í•˜ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”...")

    example_3_sequential_tool_calls()
    input("\nâ ê³„ì†í•˜ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”...")

    example_4_parallel_tool_calls()
    input("\nâ ê³„ì†í•˜ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”...")

    example_5_complete_react_loop()

    # ë§ˆë¬´ë¦¬
    print("\n" + "=" * 70)
    print("ğŸ‰ ReAct íŒ¨í„´ ì˜ˆì œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!")
    print("=" * 70)
    print("\nğŸ’¡ ë‹¤ìŒ ë‹¨ê³„:")
    print("  1. 04_custom_prompt.py - System Prompt ì»¤ìŠ¤í„°ë§ˆì´ì§•")
    print("  2. 05_streaming_agent.py - ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„")
    print("\nğŸ“š ì¶”ê°€ í•™ìŠµ:")
    print("  â€¢ ReAct ë…¼ë¬¸: https://arxiv.org/abs/2210.03629")
    print("  â€¢ ê³µì‹ ë¬¸ì„œ: /official/06-agents.md (ë¼ì¸ 178-237)")
    print("\n" + "=" * 70 + "\n")


# ============================================================================
# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
# ============================================================================

if __name__ == "__main__":
    main()


# ============================================================================
# ğŸ“š ì¶”ê°€ í•™ìŠµ í¬ì¸íŠ¸
# ============================================================================
#
# 1. ReAct vs Chain-of-Thought (CoT):
#    - CoT: ìˆœìˆ˜í•œ ì¶”ë¡ ë§Œ (ë„êµ¬ ì‚¬ìš© ì—†ìŒ)
#    - ReAct: ì¶”ë¡  + ë„êµ¬ ì‚¬ìš© (ë” ì‹¤ìš©ì )
#    - ReAct = CoT + Tool Calling
#
# 2. ReAct íŒ¨í„´ì˜ í•µì‹¬ ì›ë¦¬:
#    - Reasoning: í˜„ì¬ ìƒí™© ë¶„ì„, ë‹¤ìŒ í–‰ë™ ê²°ì •
#    - Acting: ë„êµ¬ ì‹¤í–‰, ì™¸ë¶€ ì‹œìŠ¤í…œ í˜¸ì¶œ
#    - Observation: ê²°ê³¼ í™•ì¸, ìƒˆë¡œìš´ ì •ë³´ íšë“
#    - ë°˜ë³µ: ëª©í‘œ ë‹¬ì„±ê¹Œì§€ ìœ„ ê³¼ì • ë°˜ë³µ
#
# 3. ìˆœì°¨ vs ë³‘ë ¬ ë„êµ¬ í˜¸ì¶œ:
#    - ìˆœì°¨: ì´ì „ ê²°ê³¼ê°€ ë‹¤ìŒ ì…ë ¥ì´ ë˜ëŠ” ê²½ìš°
#    - ë³‘ë ¬: ë…ë¦½ì ì¸ ë„êµ¬ë“¤ì„ ë™ì‹œ ì‹¤í–‰
#    - LLMì´ ìë™ìœ¼ë¡œ íŒë‹¨í•˜ì—¬ ê²°ì •
#
# 4. ReAct ë””ë²„ê¹… íŒ:
#    - result["messages"]ë¡œ ì „ì²´ ì¶”ë¡  ê³¼ì • í™•ì¸
#    - ê° ë‹¨ê³„ì˜ tool_callsì™€ ê²°ê³¼ë¥¼ ì¶”ì 
#    - System Promptë¡œ ì¶”ë¡  ë°©ì‹ ê°€ì´ë“œ
#
# 5. ì‹¤ì „ í™œìš©:
#    - ë©€í‹°ìŠ¤í… ê²€ìƒ‰: ê²€ìƒ‰ â†’ í•„í„°ë§ â†’ ìƒì„¸ ì¡°íšŒ
#    - ë°ì´í„° ë¶„ì„: ì¡°íšŒ â†’ ê³„ì‚° â†’ ì‹œê°í™”
#    - ì›Œí¬í”Œë¡œìš° ìë™í™”: ì¡°ê±´ í™•ì¸ â†’ ì‹¤í–‰ â†’ ê²€ì¦
#
# ============================================================================
# ğŸ› ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œ
# ============================================================================
#
# ë¬¸ì œ: Agentê°€ ë„ˆë¬´ ë§ì€ ë„êµ¬ë¥¼ í˜¸ì¶œí•¨ (ë¹„íš¨ìœ¨ì )
# í•´ê²°:
#   System Promptì— "ìµœì†Œí•œì˜ ë„êµ¬ë§Œ ì‚¬ìš©í•˜ì„¸ìš”" ì¶”ê°€
#   temperatureë¥¼ ë‚®ì¶°ì„œ ì¼ê´€ì„± í–¥ìƒ
#
# ë¬¸ì œ: Agentê°€ ë¬´í•œ ë£¨í”„ì— ë¹ ì§
# í•´ê²°:
#   config={"recursion_limit": 10}ìœ¼ë¡œ ìµœëŒ€ ë°˜ë³µ ì œí•œ
#   ë„êµ¬ê°€ ëª…í™•í•œ ì¢…ë£Œ ì¡°ê±´ì„ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •
#
# ë¬¸ì œ: ë³‘ë ¬ ì‹¤í–‰ì´ ì•ˆ ë˜ê³  ìˆœì°¨ ì‹¤í–‰ë¨
# í•´ê²°:
#   ë” ê°•ë ¥í•œ ëª¨ë¸ ì‚¬ìš© (gpt-4o)
#   System Promptì— "ë…ë¦½ì ì¸ ì‘ì—…ì€ ë³‘ë ¬ë¡œ ì²˜ë¦¬í•˜ì„¸ìš”" ì¶”ê°€
#
# ë¬¸ì œ: Reasoning ê³¼ì •ì´ ë³´ì´ì§€ ì•ŠìŒ
# í•´ê²°:
#   System Promptì— "ê° ë‹¨ê³„ë¥¼ ì„¤ëª…í•˜ì„¸ìš”" ì¶”ê°€
#   verbose=True ëª¨ë“œ ì‚¬ìš© (LangChain ì„¤ì •)
#
# ============================================================================
