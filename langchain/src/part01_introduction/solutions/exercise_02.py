"""
================================================================================
LangChain AI Agent ë§ˆìŠ¤í„° êµì•ˆ
Part 1: AI Agentì˜ ì´í•´ - ì‹¤ìŠµ ê³¼ì œ 2 í•´ë‹µ
================================================================================

ê³¼ì œ: ì²« ë²ˆì§¸ Agent ì‹¤í–‰

ë‚œì´ë„: â­â˜†â˜† (ì…ë¬¸)

ìš”êµ¬ì‚¬í•­:
1. 01_hello_langchain.py ì½ê³  ì´í•´í•˜ê¸°
2. ì½”ë“œ ì‹¤í–‰í•˜ê¸°
3. ì§ˆë¬¸ì„ ë°”ê¿”ì„œ ë‹¤ì‹œ ì‹¤í–‰í•´ë³´ê¸°

ì¶”ê°€ ë„ì „:
- ë„êµ¬ ì„¤ëª…(docstring)ì„ ë³€ê²½í•˜ë©´ Agent ì‘ë‹µì´ ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ì§€ ê´€ì°°
- system_promptë¥¼ ë³€ê²½í•˜ì—¬ Agentì˜ ì„±ê²© ë°”ê¾¸ê¸°

í•™ìŠµ ëª©í‘œ:
- create_agent()ë¡œ Agentë¥¼ ìƒì„±í•˜ê³  ì‹¤í–‰í•˜ëŠ” ë°©ë²• ì´í•´
- ë„êµ¬(Tool)ì˜ docstringì´ Agent í–‰ë™ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ê´€ì°°
- system_promptë¡œ Agentì˜ ì‘ë‹µ ìŠ¤íƒ€ì¼ì„ ì œì–´í•˜ëŠ” ë°©ë²• ì²´í—˜

================================================================================
"""

import os
from dotenv import load_dotenv
from langchain.agents import create_agent
from langchain_core.tools import tool

# í™˜ê²½ ì„¤ì •
load_dotenv(override=True)

if not os.getenv("OPENAI_API_KEY"):
    print("âŒ OPENAI_API_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
    print("ğŸ“ src/.env íŒŒì¼ì„ í™•ì¸í•˜ê³  API í‚¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”.")
    exit(1)


# ============================================================================
# ë„êµ¬ ì •ì˜
# ============================================================================

@tool
def get_weather(city: str) -> str:
    """ì£¼ì–´ì§„ ë„ì‹œì˜ ë‚ ì”¨ë¥¼ ì•Œë ¤ì¤ë‹ˆë‹¤."""
    weather_data = {
        "ì„œìš¸": "ë§‘ìŒ, 15Â°C",
        "ë‰´ìš•": "íë¦¼, 8Â°C",
        "ìƒŒí”„ë€ì‹œìŠ¤ì½”": "í™”ì°½í•¨, 18Â°C",
        "ë„ì¿„": "ë¹„, 12Â°C",
        "ëŸ°ë˜": "ì•ˆê°œ, 10Â°C",
    }
    return weather_data.get(city, f"{city}ì˜ ë‚ ì”¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")


@tool
def get_weather_detailed(city: str) -> str:
    """ì£¼ì–´ì§„ ë„ì‹œì˜ ë‚ ì”¨, ìŠµë„, í’ì†, ì²´ê° ì˜¨ë„ë¥¼ í¬í•¨í•œ ìƒì„¸ ê¸°ìƒ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤."""
    weather_data = {
        "ì„œìš¸": "ë§‘ìŒ, 15Â°C, ìŠµë„ 45%, í’ì† 5km/h, ì²´ê°ì˜¨ë„ 13Â°C",
        "ë‰´ìš•": "íë¦¼, 8Â°C, ìŠµë„ 70%, í’ì† 15km/h, ì²´ê°ì˜¨ë„ 4Â°C",
        "ìƒŒí”„ë€ì‹œìŠ¤ì½”": "í™”ì°½í•¨, 18Â°C, ìŠµë„ 55%, í’ì† 10km/h, ì²´ê°ì˜¨ë„ 17Â°C",
    }
    return weather_data.get(city, f"{city}ì˜ ë‚ ì”¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")


# ============================================================================
# ì‹¤í—˜ 1: ë‹¤ì–‘í•œ ì§ˆë¬¸ìœ¼ë¡œ Agent ì‹¤í–‰
# ============================================================================

def experiment_1_different_questions():
    """
    ê°™ì€ Agentì— ë‹¤ë¥¸ ì§ˆë¬¸ì„ ë³´ë‚´ì–´ ì‘ë‹µ ì°¨ì´ë¥¼ ê´€ì°°í•©ë‹ˆë‹¤.
    ğŸ“– êµì•ˆ: Part 1 > ì‹¤ìŠµ ê³¼ì œ > ê³¼ì œ 2 - ìš”êµ¬ì‚¬í•­ 3
    """
    print("=" * 60)
    print("ì‹¤í—˜ 1: ë‹¤ì–‘í•œ ì§ˆë¬¸ìœ¼ë¡œ Agent ì‹¤í–‰")
    print("=" * 60)

    agent = create_agent(
        model="openai:gpt-4.1-nano",
        tools=[get_weather],
        system_prompt="ë‹¹ì‹ ì€ ì¹œì ˆí•œ ë‚ ì”¨ ë„ìš°ë¯¸ì…ë‹ˆë‹¤.",
    )

    questions = [
        "ì„œìš¸ ë‚ ì”¨ëŠ”?",
        "ë„ì¿„ ë‚ ì”¨ ì•Œë ¤ì¤˜",
        "ì„œìš¸ì´ë‘ ë‰´ìš• ë‚ ì”¨ ë¹„êµí•´ì¤˜",
        "íŒŒë¦¬ ë‚ ì”¨ ì–´ë•Œ?",  # ë°ì´í„°ì— ì—†ëŠ” ë„ì‹œ
    ]

    for q in questions:
        print(f"\nğŸ‘¤ ì§ˆë¬¸: {q}")
        result = agent.invoke(
            {"messages": [{"role": "user", "content": q}]}
        )
        print(f"ğŸ¤– ì‘ë‹µ: {result['messages'][-1].content}")

    print("\nğŸ’¡ ê´€ì°° í¬ì¸íŠ¸:")
    print("  - AgentëŠ” ì§ˆë¬¸ì— ë”°ë¼ ì ì ˆí•œ ë„êµ¬ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤")
    print("  - ë¹„êµ ì§ˆë¬¸ì—ì„œëŠ” ì—¬ëŸ¬ ë„ì‹œì˜ ë„êµ¬ë¥¼ ê°ê° í˜¸ì¶œí•©ë‹ˆë‹¤")
    print("  - ë°ì´í„°ì— ì—†ëŠ” ë„ì‹œë„ ë„êµ¬ë¥¼ ì‹œë„í•˜ê³  ê²°ê³¼ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤")


# ============================================================================
# ì‹¤í—˜ 2: docstring ë³€ê²½ìœ¼ë¡œ Agent í–‰ë™ ë³€í™” ê´€ì°°
# ============================================================================

def experiment_2_docstring_effect():
    """
    ê°™ì€ ê¸°ëŠ¥ì´ì§€ë§Œ ë‹¤ë¥¸ docstringì„ ê°€ì§„ ë„êµ¬ê°€
    Agentì˜ í–‰ë™ì— ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ”ì§€ ê´€ì°°í•©ë‹ˆë‹¤.
    ğŸ“– êµì•ˆ: Part 1 > ì‹¤ìŠµ ê³¼ì œ > ê³¼ì œ 2 (ì¶”ê°€ ë„ì „)
    """
    print("\n" + "=" * 60)
    print("ì‹¤í—˜ 2: docstring ë³€ê²½ì˜ íš¨ê³¼")
    print("=" * 60)

    question = "ì„œìš¸ ë‚ ì”¨ ì•Œë ¤ì¤˜"

    # ë„êµ¬ 1: ê°„ë‹¨í•œ docstring
    print("\nğŸ”¹ [ë„êµ¬ A] ê°„ë‹¨í•œ docstring:")
    print('   """ì£¼ì–´ì§„ ë„ì‹œì˜ ë‚ ì”¨ë¥¼ ì•Œë ¤ì¤ë‹ˆë‹¤."""')
    agent_a = create_agent(
        model="openai:gpt-4.1-nano",
        tools=[get_weather],
        system_prompt="ë‹¹ì‹ ì€ ë‚ ì”¨ ë„ìš°ë¯¸ì…ë‹ˆë‹¤.",
    )
    result_a = agent_a.invoke(
        {"messages": [{"role": "user", "content": question}]}
    )
    print(f"   ğŸ¤– ì‘ë‹µ: {result_a['messages'][-1].content}")

    # ë„êµ¬ 2: ìƒì„¸í•œ docstring
    print("\nğŸ”¹ [ë„êµ¬ B] ìƒì„¸í•œ docstring:")
    print('   """ì£¼ì–´ì§„ ë„ì‹œì˜ ë‚ ì”¨, ìŠµë„, í’ì†, ì²´ê° ì˜¨ë„ë¥¼ í¬í•¨í•œ ìƒì„¸ ê¸°ìƒ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤."""')
    agent_b = create_agent(
        model="openai:gpt-4.1-nano",
        tools=[get_weather_detailed],
        system_prompt="ë‹¹ì‹ ì€ ë‚ ì”¨ ë„ìš°ë¯¸ì…ë‹ˆë‹¤.",
    )
    result_b = agent_b.invoke(
        {"messages": [{"role": "user", "content": question}]}
    )
    print(f"   ğŸ¤– ì‘ë‹µ: {result_b['messages'][-1].content}")

    print("\nğŸ’¡ ê´€ì°° í¬ì¸íŠ¸:")
    print("  - docstringì´ ìƒì„¸í•˜ë©´ Agentê°€ ë” í’ë¶€í•œ ì •ë³´ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤")
    print("  - AgentëŠ” docstringì„ ì½ê³  ë„êµ¬ì˜ ìš©ë„ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤")
    print("  - ì¢‹ì€ docstring = ë” ì •í™•í•œ ë„êµ¬ ì‚¬ìš©!")


# ============================================================================
# ì‹¤í—˜ 3: system_promptë¡œ Agent ì„±ê²© ë°”ê¾¸ê¸°
# ============================================================================

def experiment_3_system_prompt():
    """
    system_promptë¥¼ ë³€ê²½í•˜ì—¬ Agentì˜ ì‘ë‹µ ìŠ¤íƒ€ì¼ì´
    ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ì§€ ê´€ì°°í•©ë‹ˆë‹¤.
    ğŸ“– êµì•ˆ: Part 1 > ì‹¤ìŠµ ê³¼ì œ > ê³¼ì œ 2 (ì¶”ê°€ ë„ì „)
    """
    print("\n" + "=" * 60)
    print("ì‹¤í—˜ 3: system_promptë¡œ Agent ì„±ê²© ë°”ê¾¸ê¸°")
    print("=" * 60)

    question = "ì„œìš¸ ë‚ ì”¨ ì–´ë•Œ?"

    prompts = {
        "ì¹œì ˆí•œ ë„ìš°ë¯¸": "ë‹¹ì‹ ì€ ì¹œì ˆí•˜ê³  ë”°ëœ»í•œ ë‚ ì”¨ ë„ìš°ë¯¸ì…ë‹ˆë‹¤. ì´ëª¨í‹°ì½˜ì„ ì‚¬ìš©í•˜ì—¬ ë‹µë³€í•˜ì„¸ìš”.",
        "ê°„ê²°í•œ ë¹„ì„œ": "ë‹¹ì‹ ì€ ê°„ê²°í•œ ë¹„ì„œì…ë‹ˆë‹¤. í•µì‹¬ë§Œ ì§§ê²Œ ë‹µë³€í•˜ì„¸ìš”. ìµœëŒ€ 2ë¬¸ì¥.",
        "ê¸°ìƒ ìºìŠ¤í„°": "ë‹¹ì‹ ì€ ì „ë¬¸ ê¸°ìƒ ìºìŠ¤í„°ì…ë‹ˆë‹¤. ë‚ ì”¨ë¥¼ ë°©ì†¡í•˜ë“¯ ìƒë™ê° ìˆê²Œ ì „ë‹¬í•˜ì„¸ìš”.",
    }

    for name, prompt in prompts.items():
        print(f"\nğŸ”¹ [{name}]")
        print(f"   system_prompt: \"{prompt[:50]}...\"")

        agent = create_agent(
            model="openai:gpt-4.1-nano",
            tools=[get_weather],
            system_prompt=prompt,
        )
        result = agent.invoke(
            {"messages": [{"role": "user", "content": question}]}
        )
        print(f"   ğŸ¤– ì‘ë‹µ: {result['messages'][-1].content}")

    print("\nğŸ’¡ ê´€ì°° í¬ì¸íŠ¸:")
    print("  - ê°™ì€ ë„êµ¬, ê°™ì€ ì§ˆë¬¸ì´ì§€ë§Œ ì‘ë‹µ ìŠ¤íƒ€ì¼ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤")
    print("  - system_promptëŠ” Agentì˜ 'ì„±ê²©'ì„ ê²°ì •í•©ë‹ˆë‹¤")
    print("  - ì‹¤ë¬´ì—ì„œëŠ” ì‚¬ìš© ì‚¬ë¡€ì— ë§ê²Œ system_promptë¥¼ ì„¤ê³„í•©ë‹ˆë‹¤")


# ============================================================================
# ë©”ì¸ ì‹¤í–‰
# ============================================================================

def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    print("\n")
    print("=" * 60)
    print("Part 1 ì‹¤ìŠµ ê³¼ì œ 2 - ì²« ë²ˆì§¸ Agent ì‹¤í–‰")
    print("=" * 60)

    # ì‹¤í—˜ 1: ë‹¤ì–‘í•œ ì§ˆë¬¸
    try:
        experiment_1_different_questions()
    except Exception as e:
        print(f"âŒ ì‹¤í—˜ 1 ì˜¤ë¥˜: {e}")

    input("\nâ ê³„ì†í•˜ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”...")

    # ì‹¤í—˜ 2: docstring ë³€ê²½ íš¨ê³¼
    try:
        experiment_2_docstring_effect()
    except Exception as e:
        print(f"âŒ ì‹¤í—˜ 2 ì˜¤ë¥˜: {e}")

    input("\nâ ê³„ì†í•˜ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”...")

    # ì‹¤í—˜ 3: system_prompt ë³€ê²½ íš¨ê³¼
    try:
        experiment_3_system_prompt()
    except Exception as e:
        print(f"âŒ ì‹¤í—˜ 3 ì˜¤ë¥˜: {e}")

    # ìš”ì•½
    print("\n" + "=" * 60)
    print("í•µì‹¬ ì •ë¦¬")
    print("=" * 60)
    print()
    print("  âœ… create_agent()ë¡œ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” Agentë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤")
    print("  âœ… ë‹¤ì–‘í•œ ì§ˆë¬¸ì— Agentê°€ ììœ¨ì ìœ¼ë¡œ ë„êµ¬ë¥¼ ì„ íƒí•œë‹¤")
    print("  âœ… docstringì€ Agentì˜ ë„êµ¬ ì‚¬ìš© íŒë‹¨ì— ì˜í–¥ì„ ì¤€ë‹¤")
    print("  âœ… system_promptë¡œ Agentì˜ ì‘ë‹µ ìŠ¤íƒ€ì¼ì„ ì œì–´í•  ìˆ˜ ìˆë‹¤")
    print()
    print("  ë‹¤ìŒ ë‹¨ê³„: Part 2 - LangChain ê¸°ì´ˆë¡œ ì´ë™")
    print("\n" + "=" * 60 + "\n")


if __name__ == "__main__":
    main()
